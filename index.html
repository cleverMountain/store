<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

</head>

<body>
  <script type="module">
    import { createStore } from "./index.js"
    const option = {
      state: {
        age: 1,
        age2: 2
      },
      getters: {
        age(state) {
          return state.age + 2
        }
      },
      // 唯一修改状态的地方
      mutations: {
        add(state, payload) {
          state.age += payload
        },
        add2(state, payload) {

          state.age2 += payload
        }
      },
      actions: {
        add1({ commit }, payload) {
          console.log(this)
          setTimeout(() => {

            commit('add2', payload)
          }, 1000)
        }
      },
      modules: {
        a: {
          namespaced: true,
          state: {
            age: 11
          },
          mutations: {
            add(state, payload) {

              state.age += payload
            }
          },
          actions: {
            add1({ commit }, payload) {

              let that = this
              console.log(this)
              setTimeout(() => {
                commit.call(that, 'add', payload)
              }, 1000)
            }
          },
          modules: {
            b: {
              namespaced: true,
              state: {
                age: 12
              },
              mutations: {
                add(state, payload) {

                  state.age += payload
                }
              },
              actions: {
                add({ commit }, payload) {
                  setTimeout(() => {
                    commit('add', payload)
                  }, 1000)
                }
              }
            }
          }
        }
      }
    }
    const store = createStore(option)
    console.log(store)
  </script>
</body>

</html>